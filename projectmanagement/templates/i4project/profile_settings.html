{% extends 'index.html' %}
{% block title %}Profile Settings - TaskFlow{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Header -->
    <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">Profile Settings</h1>
        <p class="text-gray-600">Update your personal information and profile picture</p>
    </div>

    <!-- Profile Card -->
    <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-2xl p-8 border border-white/20">
        <form enctype="multipart/form-data" method="post" class="space-y-8">
            {% csrf_token %}
            
            <!-- Profile Image Section -->
            <div class="text-center mb-8">
                <div class="relative inline-block">
                    <div class="w-32 h-32 rounded-full overflow-hidden border-4 border-white shadow-lg mx-auto mb-4">
                        {% if user.profile.profile_image %}
                            <img id="profile-preview" src="{{ user.profile.profile_image.url }}" alt="Profile" class="w-full h-full object-cover">
                        {% else %}
                            <div id="profile-preview" class="w-full h-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center">
                                <i class="fas fa-user text-white text-4xl"></i>
                            </div>
                        {% endif %}
                    </div>
                    <label for="id_profile_image" class="absolute bottom-2 right-2 bg-blue-500 text-white p-2 rounded-full cursor-pointer hover:bg-blue-600 transition-colors shadow-lg">
                        <i class="fas fa-camera"></i>
                    </label>
                </div>
                <p class="text-sm text-gray-500">Click the camera icon to change your profile picture</p>
            </div>

            <!-- Form Fields -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Username Field -->
                <div>
                    <label class="block text-gray-700 font-semibold mb-3 text-sm uppercase tracking-wide">
                        <i class="fas fa-user mr-2"></i>Username
                    </label>
                    <input 
                        type="text" 
                        name="username" 
                        value="{{ form.username.value|default_if_none:'' }}" 
                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300 bg-white/50 backdrop-blur-sm"
                        placeholder="Enter your username"
                    >
                    {% if form.username.errors %}
                        <div class="mt-2 text-red-600 text-sm">
                            {% for error in form.username.errors %}
                                <i class="fas fa-exclamation-circle mr-1"></i>{{ error }}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- First Name Field -->
                <div>
                    <label class="block text-gray-700 font-semibold mb-3 text-sm uppercase tracking-wide">
                        <i class="fas fa-id-card mr-2"></i>First Name
                    </label>
                    <input 
                        type="text" 
                        name="first_name" 
                        value="{{ form.first_name.value|default_if_none:'' }}" 
                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300 bg-white/50 backdrop-blur-sm"
                        placeholder="Enter your first name"
                    >
                    {% if form.first_name.errors %}
                        <div class="mt-2 text-red-600 text-sm">
                            {% for error in form.first_name.errors %}
                                <i class="fas fa-exclamation-circle mr-1"></i>{{ error }}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Last Name Field -->
                <div>
                    <label class="block text-gray-700 font-semibold mb-3 text-sm uppercase tracking-wide">
                        <i class="fas fa-id-card mr-2"></i>Last Name
                    </label>
                    <input 
                        type="text" 
                        name="last_name" 
                        value="{{ form.last_name.value|default_if_none:'' }}" 
                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300 bg-white/50 backdrop-blur-sm"
                        placeholder="Enter your last name"
                    >
                    {% if form.last_name.errors %}
                        <div class="mt-2 text-red-600 text-sm">
                            {% for error in form.last_name.errors %}
                                <i class="fas fa-exclamation-circle mr-1"></i>{{ error }}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Profile Image Field (Hidden) -->
                <div class="hidden">
                    <input 
                        type="file" 
                        name="profile_image" 
                        id="id_profile_image" 
                        accept="image/*"
                        class="hidden"
                        onchange="previewImage(this)"
                    >
                </div>
            </div>

            <!-- Messages -->
            {% if messages %}
                <div class="space-y-3">
                    {% for message in messages %}
                        <div class="p-4 rounded-xl {% if message.tags == 'success' %}bg-green-50 text-green-800 border border-green-200{% elif message.tags == 'error' %}bg-red-50 text-red-800 border border-red-200{% else %}bg-blue-50 text-blue-800 border border-blue-200{% endif %}">
                            <div class="flex items-center">
                                <i class="fas {% if message.tags == 'success' %}fa-check-circle{% elif message.tags == 'error' %}fa-exclamation-circle{% else %}fa-info-circle{% endif %} mr-3"></i>
                                {{ message }}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}

            <!-- Action Buttons -->
            <div class="flex space-x-4 pt-6">
                <button type="submit" 
                    class="flex-1 bg-gradient-to-r from-blue-500 to-purple-600 text-white py-3 rounded-xl font-semibold hover:from-blue-600 hover:to-purple-700 transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl">
                    <i class="fas fa-save mr-2"></i>Save Changes
                </button>
                <a href="{% url 'home' %}" 
                   class="flex-1 bg-gray-500 text-white py-3 rounded-xl font-semibold hover:bg-gray-600 transition-all duration-300 text-center">
                   <i class="fas fa-times mr-2"></i>Cancel
                </a>
            </div>
        </form>
    </div>

    <!-- Back Link -->
    <div class="text-center mt-6">
        <a href="{% url 'home' %}" 
           class="inline-flex items-center space-x-2 text-gray-600 hover:text-blue-600 transition-colors">
           <i class="fas fa-arrow-left"></i>
           <span>Back to Dashboard</span>
        </a>
    </div>
</div>

<script>
function previewImage(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        
        reader.onload = function(e) {
            const preview = document.getElementById('profile-preview');
            if (preview.tagName === 'IMG') {
                preview.src = e.target.result;
            } else {
                // Replace the div with an img
                const img = document.createElement('img');
                img.src = e.target.result;
                img.alt = 'Profile Preview';
                img.className = 'w-full h-full object-cover';
                img.id = 'profile-preview';
                preview.parentNode.replaceChild(img, preview);
            }
        };
        
        reader.readAsDataURL(input.files[0]);
    }
}

// Add click handler for the profile image area
document.addEventListener('DOMContentLoaded', function() {
    const profileImageArea = document.querySelector('.relative.inline-block');
    const fileInput = document.getElementById('id_profile_image');
    
    profileImageArea.addEventListener('click', function(e) {
        // Don't trigger if clicking on the camera icon (it has its own handler)
        if (!e.target.closest('label')) {
            fileInput.click();
        }
    });
});
</script>
{% endblock %}